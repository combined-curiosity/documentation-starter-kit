import Image from "next/image"
import { Callout } from "nextra/components"

# User Deletion Requests

Occasionally a user will email us requesting that we delete all personally identifiable information (PII) from our systems. We are potentially legally obligated to comply with this request (depending on the jurisdiction in which the user is locate), and we are morally obligated to do so as well (depending on your value system I suppose). Here is the process for how the support team can gather the necessary information and hand it off to the dev team and the process for the dev team to complete the deletion request.


## Sending the request to dev-help [#reporting-to-dev-help]

When we receive the request, we need to determine which brand they are associated with, if the user is a paid or unpaid user, if they received a refund, or if they are only a lead and are not in the xms. 


## If the user is a paid customer and wishes to continue being a paid customer

If they want to continue being a customer we're fairly limited in what we can actually remove. We still need record of their email address in the xms, stripe, and zendesk for transactional email purposes. In the xms, we'll need to mark them as "do not track" to skip sending their email to drip.

in order, remove them from:

1. [drip](#drip-removal)
2. [event tracking](#event-tracking-removal)
3. [zendesk](#zendesk-removal)


<Callout type="info">
**NOTE** The ongoing "do not track" functionality does not exist yet because it has never been requested and it requires some build to accomplish. We will address this if it ever happens.

**TO DISCUSS**: do we change their email address to something generic so that they just have a "username" and denote them as do not track?
</Callout>


## If the user is a paid customer that has received a refund

in order, remove them from:

1. [drip](#drip-removal)
2. [xms](#xms-removal)
3. [event tracking](#event-tracking-removal)
4. [zendesk](#zendesk-removal)
5. [stripe](#stripe-removal)

## If the user is a non-paid user

in order, remove them from:

1. [drip](#drip-removal)
2. [xms](#xms-removal)
3. [event tracking](#event-tracking-removal)
4. [zendesk](#zendesk-removal)

## If the user is only a lead

in order, remove them from:

1. [drip](#drip-removal)
2. [xms](#xms-removal)
3. [event tracking](#event-tracking-removal)
4. [zendesk](#zendesk-removal)

## If the user is not a lead

All we have to do here is delete the correspondence & their record in Zendesk (and ponder why they reached out to us in the first place) since this is now our only record of their PII.

1. [zendesk](#zendesk-removal)

## Removing the user from drip [#drip-removal]

This has two parts, step one is removing their record from Drip and step two is removing their synced drip information from our data warehouse

### Removing their record from Drip [#drip-service-removal]

Look up their email in the brand's drip account and make note of their subscriber id in the url bar. You don't strictly need this, but it's helpful when removing the subscriber from the [warehouse](#drip-warehouse-removal) in the event that something is done out of order.

{/* mf7cwu127oia8o7thbm0 */}

<Image src="/user-deletion-requests/drip-get-subscriber-id.png" width={800} height={400}/>

Click the three dot menu in the upper right and then click "Delete person"

<Image src="/user-deletion-requests/drip-delete-subscriber.png" width={800} height={400}/>

### Removing their drip records from the warehouse [#drip-warehouse-removal]

We record the user's email address in the warehouse database (`analytics.czslou0qz9oj.us-east-2.rds.amazonaws.com`) in the following tables that are generated from drip webhooks:

- `email.subscriber_emails`
- `email.subscriber_summary`

Tables not listed here that contain an email address are generated by dbt from these source tables so the email will be deleted on the next dbt run.

The following query can be used to bulk update all instances of the person's email address to an anonymized placeholder. This removes their PII from the system while preserving the fact that we did send an email to somebody.

## Removing the user from the xms database [#xms-removal]


## Removing the user from event tracking [#event-tracking-removal]

This comes either 4 or 5 stages:

1. delete the `identity` entries that are related to the user
2. delete the `person` entry that represents all the identities
3. delete all `event` entries tied to the deleted `person`
4. delete all `call_log` entries that are related to those deleted `events`
5. if they were a lead or purchaser, search for possible integration events and delete those. current list of topics are:
- `/v1/integrations/users/action/`
- `/v1/integrations/users/lead/`
- `/v1/integrations/users/system_action/`
- `/v1/integrations/users/update_email`
- `/v1/integrations/orders/`



## Removing the user from Zendesk [#zendesk-removal]

<Callout type="info">
**TO DISCUSS**: because we don't use zendesk for marketing purposes, the argument for preserving these data is that we have a legitimate business interest in keeping the record of their customer service interactions in zendesk because it would improve our level of service with the person if they reach out to us in the future. 
</Callout>

## Removing the user from Stripe [#stripe-removal]

<Callout type="info">
**TO DISCUSS**: arguably we would only have to do this for people who recieved a refund because they're no longer a customer with us. If we remove them from stripe, we should just change their email address to a placeholder that we would use on the xms or elsewhere to track that a refund occurred. That said it doesn't seem totally necessary to remove them here because of the nature of a purchase - the argument is that we have a legitimate business interest in maintaining the fact that someone with email address `x@example.com` purchased from us in the past and subsequently requested a refund because in the future we might decide to not honor their credit card due to the cost of transacting with them
</Callout>